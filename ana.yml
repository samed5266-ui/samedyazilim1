name: Samed Panel APK Builder
on: [push, workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Kodlari Cek
        uses: actions/checkout@v4

      - name: Java 17 Kurulumu
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Proje Yapisini ve Motoru Sifirdan Kur
        run: |
          # 1. Klasörleri oluştur
          mkdir -p app/src/main/java/com/samed/panel
          mkdir -p app/src/main/res/layout

          # 2. Ana dizindeki dosyalarını yerlerine taşı
          [ -f MainActivity.java ] && mv MainActivity.java app/src/main/java/com/samed/panel/
          [ -f mainactivity.java ] && mv mainactivity.java app/src/main/java/com/samed/panel/MainActivity.java
          [ -f BootReceiver.java ] && mv BootReceiver.java app/src/main/java/com/samed/panel/
          [ -f bootreceiver.java ] && mv bootreceiver.java app/src/main/java/com/samed/panel/BootReceiver.java
          [ -f activity_main.xml ] && mv activity_main.xml app/src/main/res/layout/
          [ -f androidmanifest.xml ] && mv androidmanifest.xml app/src/main/AndroidManifest.xml
          [ -f AndroidManifest.xml ] && mv AndroidManifest.xml app/src/main/AndroidManifest.xml

          # 3. Eksik olan motoru (Wrapper) SIFIRDAN kur
          gradle wrapper --gradle-version 8.5

          # 4. Ayarları AndroidX için zorla güncelle
          echo "android.useAndroidX=true" > gradle.properties
          echo "android.enableJetifier=true" >> gradle.properties

      - name: APK Derle
        run: |
          chmod +x gradlew
          ./gradlew assembleDebug --no-daemon

      - name: APK'yi Yukle
        if: success()
        uses: actions/upload-artifact@v4
        with:
          name: Samed-Panel-APK
          path: app/build/outputs/apk/debug/app-debug.apk
